var webCacheInternal=new function(){this.physicalSite="pSite";this._sessionStorage=window.sessionStorage;this._localStorage=window.localStorage;this.setItem=function(key,item){if(typeof item!=="string"){item=JSON.stringify(item)}this._sessionStorage.setItem(key,item)};this.getItem=function(key){var item=this._sessionStorage.getItem(key);if(item!=="undefined"){return JSON.parse(item)}else{return null}};this.getCodePdv=function(key){var item=this._sessionStorage.getItem(key);return item};this.removeItem=function(key){this._sessionStorage.removeItem(key);return 1};this.removeItemLocalStorage=function(key){this._localStorage.removeItem(key);return 1};this.setItemLocalStorage=function(key,item){if(typeof item!=="string"){item=JSON.stringify(item)}this._localStorage.setItem(key,item)};this.getLocalStorageItem=function(key){var item=this._localStorage.getItem(key);if(item!=="undefined"){return JSON.parse(item)}else{return null}};this.responseFromBrr=function(rrdiVal){var responseBrr;if(rrdiVal!=null){try{jQueryJBN.ajax({type:"POST",url:"/do/WebCache",async:false,data:{rrdi:rrdiVal,},dataType:"json",cache:false,success:function(response,textStatus,jqXHR){if(textStatus==="success"){responseBrr=JSON.parse(JSON.stringify(response))}},error:function(jqXHR,textStatus,errorThrown){console.log("An error occured: status='"+textStatus+"',error='"+errorThrown+"'")}})}catch(e){console.error(e)}}return responseBrr};this.getBrrPSite=function(rrdiVal){var pSite=this.responseFromBrr(rrdiVal);this.setItem(this.physicalSite,pSite);this.setItemLocalStorage(this.physicalSite,pSite);return pSite};this.getPSite=function(rrdiVal){var pSite=this.getItem(this.physicalSite);if(pSite===undefined||pSite===null){if(rrdiVal!==null&&rrdiVal!==undefined){pSite=this.getBrrPSite(rrdiVal)}}if(pSite===undefined||pSite===null){pSite=this.getLocalStorageItem(this.physicalSite)}return pSite};this.getRrdiByContractTypeBrand=function(brand,contractType){var pSite=this.getPSite();var listPdv;if(typeof pSite.listPdv==="string"){listPdv=JSON.parse(pSite.listPdv)}else{listPdv=pSite.listPdv}var listPdvLength=listPdv.length;var rrdiList=[];var flagPresent=false;for(var i=0;i<listPdvLength;i++){var listOfContracts=listPdv[i].contrats;var constractsSize=listPdv[i].contrats.length;flagPresent=false;for(var j=0;j<constractsSize;j++){if(listOfContracts[j].typeContrat===contractType&&listOfContracts[j].marqueContrat===brand){for(var k=0;k<rrdiList.length;k++){if(rrdiList[k]===listPdv[i].identifiantReseau){flagPresent=true;break}}if(flagPresent===false){rrdiList.push(listPdv[i].identifiantReseau)}}}}return rrdiList};this.getBrandByContractTypeRrdi=function(rrdi,contractType){var pSite=getPSite(rrdi);var listPdvLength=pSite.listPdv.length;var brandList=[];var flagPresent=false;for(var i=0;i<listPdvLength;i++){var listOfContracts=pSite.listPdv[i].contrats;var constractsSize=pSite.listPdv[i].contrats.length;flagPresent=false;for(var j=0;j<constractsSize;j++){if(listOfContracts[j].typeContrat==contractType&&pSite.listPdv[i].identifiantReseau==rrdi){for(var k=0;k<brandList.length;k++){if(brandList[k]==listOfContracts[j].marqueContrat){flagPresent=true;break}}if(flagPresent==false){brandList.push(listOfContracts[j].marqueContrat)}}}}return brandList};this.getRrdiList=function(){var pSite=this.getPSite();var listPdvLength=pSite.listPdv.length;var rrdiList=[];for(var i=0;i<listPdvLength;i++){var listRrdi=pSite.listPdv[i];rrdiList.push(listRrdi.identifiantReseau)}return rrdiList};this.getBrandList=function(){var pSite=this.getPSite();var listPdvLength=pSite.listPdv.length;var brandList=[];var flagPresent=false;for(var i=0;i<listPdvLength;i++){var listOfContracts=pSite.listPdv[i].contrats;var constractsSize=pSite.listPdv[i].contrats.length;flagPresent=false;for(var j=0;j<constractsSize;j++){for(var k=0;k<brandList.length;k++){if(brandList[k]===listOfContracts[j].marqueContrat){flagPresent=true;break}}if(flagPresent===false){brandList.push(listOfContracts[j].marqueContrat)}}}return brandList};this.getContractTypeList=function(){var pSite=this.getPSite();var listPdv;if(typeof pSite.listPdv==="string"){listPdv=JSON.parse(pSite.listPdv)}else{listPdv=pSite.listPdv}var listPdvLength=listPdv.length;var contractTypeList=[];for(var i=0;i<listPdvLength;i++){var listOfContracts=listPdv[i].contrats;var constractsSize=listPdv[i].contrats.length;for(var j=0;j<constractsSize;j++){if(!this.isPresent(listOfContracts[j].typeContrat,contractTypeList)){contractTypeList.push(listOfContracts[j].typeContrat)}}}return contractTypeList};this.sortContractList=function(contractTypeList){var sortedcontractList=[];var i=0;if(this.isPresent("APV",contractTypeList)){sortedcontractList.push("APV");i++}if(this.isPresent("PR",contractTypeList)){sortedcontractList.push("PR");i++}if(this.isPresent("VN",contractTypeList)){sortedcontractList.push("VN");i++}if(this.isPresent("ERCS",contractTypeList)){sortedcontractList.push("ERCS");i++}return sortedcontractList};this.isPresent=function(contractType,contractTypeList){if(contractTypeList===undefined){return false}for(var i=0;i<contractTypeList.length;i++){if(contractType===contractTypeList[i]){return true}else{continue}}return false};this.isRrdiInPSite=function(rrdi){var pSite=this.getPSite();var listPdvLength=pSite.listPdv.length;var rrdiFound=false;for(var i=0;i<listPdvLength;i++){var listRrdi=pSite.listPdv[i];if(rrdi===listRrdi.identifiantReseau){rrdiFound=true;break}}return rrdiFound};this.isBrandInPSite=function(brand){var pSite=this.getPSite();var listPdvLength=pSite.listPdv.length;var brandFound=false;for(var i=0;i<listPdvLength;i++){var listOfContracts=pSite.listPdv[i].contrats;var constractsSize=pSite.listPdv[i].contrats.length;for(var j=0;j<constractsSize;j++){if(listOfContracts[j].marqueContrat===brand){brandFound=true;break}}}return brandFound};this.getRrdiListByContractType=function(contractType){var pSite=this.getPSite();var listPdvLength=pSite.listPdv.length;var rrdiList=[];var flagPresent=false;for(var i=0;i<listPdvLength;i++){var listOfContracts=pSite.listPdv[i].contrats;var constractsSize=pSite.listPdv[i].contrats.length;flagPresent=false;for(var j=0;j<constractsSize;j++){if(listOfContracts[j].typeContrat===contractType){for(var k=0;k<rrdiList.length;k++){if(rrdiList[k]===pSite.listPdv[i].identifiantReseau){flagPresent=true;break}}if(flagPresent===false){rrdiList.push(pSite.listPdv[i].identifiantReseau)}}}}return rrdiList};this.getBrandListByContractType=function(contractType){var pSite=this.getPSite();var listPdvLength=pSite.listPdv.length;var brandList=[];var flagPresent=false;for(var i=0;i<listPdvLength;i++){var listOfContracts=pSite.listPdv[i].contrats;var constractsSize=pSite.listPdv[i].contrats.length;flagPresent=false;for(var j=0;j<constractsSize;j++){if(listOfContracts[j].typeContrat===contractType){for(var k=0;k<brandList.length;k++){if(brandList[k]===listOfContracts[j].marqueContrat){flagPresent=true;break}}if(flagPresent===false){brandList.push(listOfContracts[j].marqueContrat)}}}}return brandList};this.sendBrandInformation=function(brandValue){var rrdi=this.getBrandRrdiCode(brandValue);var multipleContacts=this.getMultipleContracts(brandValue);this.informServer(rrdi,multipleContacts)};this.getBrandRrdiCode=function(brandValue){var rrdiList=[];var contractList=[];var sortedcontractList=[];var rrdi=null;var multipleContacts=[];contractList=this.getContractTypeList();sortedcontractList=this.sortContractList(contractList);if(sortedcontractList.length>0){for(var i=0;i<sortedcontractList.length;i++){var contract=sortedcontractList[i];rrdiList=this.getRrdiByContractTypeBrand(brandValue,contract);if(rrdiList.length>1){multipleContacts.push(contract)}if(rrdi===null||rrdi===undefined){rrdi=rrdiList[0]}}if(rrdi===null||rrdi===undefined){rrdi=""}}return rrdi};this.getMultipleContracts=function(brandValue){var rrdiList;var multipleContacts=[];var contractList=this.getContractTypeList();var sortedcontractList=this.sortContractList(contractList);if(sortedcontractList.length>0){for(var i=0;i<sortedcontractList.length;i++){var contract=sortedcontractList[i];rrdiList=this.getRrdiByContractTypeBrand(brandValue,contract);if(rrdiList.length>1){multipleContacts.push(contract)}}}return multipleContacts};this.informServer=function(rrdi,multipleContacts){try{jQueryJBN.ajax({type:"POST",url:"/do/AjaxHeaderInfoAction",async:false,data:{rrdi:rrdi,multipleContacts:JSON.stringify(multipleContacts)},dataType:"json",cache:false,success:function(response,textStatus,jqXHR){},error:function(jqXHR,textStatus,errorThrown){}})}catch(e){console.error(e)}}};
